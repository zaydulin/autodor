{% extends 'site/useraccount/base.html' %}
{% load static user_tags i18n %}
{% block title %}{{ seo_title }}{% endblock title %}
{% block description %}{{ seo_description }}{% endblock description %}
{% block propertytitle %}{% if seo_previev %}{{ seo_previev.url }} {% endif %} {% endblock propertytitle %}
{% block propertydescription %}{{ seo_propertytitle }}{% endblock propertydescription %}
{% block propertyimage %}{{ seo_propertydescription }}{% endblock propertyimage %}
{% block head %}

{% endblock head %}

{% block content %}
<div class="conatiner-fluid content-inner mt-5 py-0">
    <div class="row">
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5>Фильтр</h5>
                </div>
                <div class="">
                    <div class="border">
                        <form method="get" action="" class="filter-form">
                            <div class="mb-3">
                                <label class="form-label">Поиск</label>
                                <input type="text" name="q" class="form-control" value="{{ params.q }}">
                            </div>

                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="form-label">Марка</label>
                                    <select name="brand" class="form-select">
                                        <option value="">Любая</option>
                                        {% for b in brands %}
                                        <option value="{{ b }}" {% if params.brand == b %}selected{% endif %}>{{ b }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Модель</label>
                                    <select name="model_auto" class="form-select">
                                        <option value="">Любая</option>
                                        {% for m in models %}
                                        <option value="{{ m }}" {% if params.model_auto == m %}selected{% endif %}>{{ m }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="row g-2 mt-2">
                                <div class="col-6">
                                    <label class="form-label">Цена от</label>
                                    <input type="text" name="price_min" class="form-control" value="{{ params.price_min }}">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Цена до</label>
                                    <input type="text" name="price_max" class="form-control" value="{{ params.price_max }}">
                                </div>
                            </div>

                            <div class="row g-2 mt-2">
                                <div class="col-6">
                                    <label class="form-label">Год от</label>
                                    <input type="number" name="year_min" class="form-control" value="{{ params.year_min }}">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Год до</label>
                                    <input type="number" name="year_max" class="form-control" value="{{ params.year_max }}">
                                </div>
                            </div>

                            <div class="row g-2 mt-2">
                                <div class="col-6">
                                    <label class="form-label">Пробег от, км</label>
                                    <input type="number" name="mileage_min" class="form-control" value="{{ params.mileage_min }}">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Пробег до, км</label>
                                    <input type="number" name="mileage_max" class="form-control" value="{{ params.mileage_max }}">
                                </div>
                            </div>

                            <div class="row g-2 mt-2">
                                <div class="col-6">
                                    <label class="form-label">Мощность от, л.с.</label>
                                    <input type="number" name="power_min" class="form-control" value="{{ params.power_min }}">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Мощность до, л.с.</label>
                                    <input type="number" name="power_max" class="form-control" value="{{ params.power_max }}">
                                </div>
                            </div>

                            <div class="row g-2 mt-2">
                                <div class="col-6">
                                    <label class="form-label">Объём от, л</label>
                                    <input type="text" name="engine_volume_min" class="form-control" value="{{ params.engine_volume_min }}">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Объём до, л</label>
                                    <input type="text" name="engine_volume_max" class="form-control" value="{{ params.engine_volume_max }}">
                                </div>
                            </div>

                            <div class="row g-2 mt-2">
                                <div class="col-6">
                                    <label class="form-label">Двери</label>
                                    <input type="number" name="doors" class="form-control" value="{{ params.doors }}">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Цвет</label>
                                    <input type="text" name="color" class="form-control" placeholder="например, schwarz" value="{{ params.color }}">
                                </div>
                            </div>

                            <div class="mt-3">
                                <label class="form-label">Валюта</label>
                                <select name="currency" class="form-select">
                                    <option value="">Любая</option>
                                    {% for c in currencies %}
                                    <option value="{{ c }}" {% if params.currency == c %}selected{% endif %}>{{ c }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="mt-3">
                                <div class="form-label">Коробка передач</div>
                                {% for val,label in transmission_choices %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="tr-{{ val }}" name="transmission" value="{{ val }}"
                                           {% if val in selected_transmissions %}checked{% endif %}>
                                    <label class="form-check-label" for="tr-{{ val }}">{{ label }}</label>
                                </div>
                                {% endfor %}

                            </div>

                            <div class="mt-3">
                                <div class="form-label">Топливо</div>
                                {% for val,label in fuel_choices %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="fu-{{ val }}" name="fuel" value="{{ val }}"
                                           {% if val in selected_fuels %}checked{% endif %}>
                                    <label class="form-check-label" for="fu-{{ val }}">{{ label }}</label>
                                </div>
                                {% endfor %}

                            </div>

                            <div class="mt-3">
                                <div class="form-label">Привод</div>
                                {% for val,label in drive_choices %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="dr-{{ val }}" name="drive" value="{{ val }}"
                                           {% if val in selected_drives %}checked{% endif %}>
                                    <label class="form-check-label" for="dr-{{ val }}">{{ label }}</label>
                                </div>
                                {% endfor %}

                            </div>

                            <div class="form-check mt-3">
                                <input class="form-check-input" type="checkbox" id="has_images" name="has_images" value="1"
                                       {% if params.has_images == '1' %}checked{% endif %}>
                                <label class="form-check-label" for="has_images">Только с фото</label>
                            </div>

                            <div class="mt-3">
                                <label class="form-label">Сортировка</label>
                                <select name="order" class="form-select">
                                    <option value="">Сначала новые</option>
                                    <option value="price_asc"  {% if params.order == 'price_asc' %}selected{% endif %}>Цена ↑</option>
                                    <option value="price_desc" {% if params.order == 'price_desc' %}selected{% endif %}>Цена ↓</option>
                                    <option value="year_desc"  {% if params.order == 'year_desc' %}selected{% endif %}>Год ↓</option>
                                    <option value="year_asc"   {% if params.order == 'year_asc' %}selected{% endif %}>Год ↑</option>
                                    <option value="mileage_asc"  {% if params.order == 'mileage_asc' %}selected{% endif %}>Пробег ↑</option>
                                    <option value="mileage_desc" {% if params.order == 'mileage_desc' %}selected{% endif %}>Пробег ↓</option>
                                </select>
                            </div>

                            <div class="d-flex gap-2 mt-3">
                                <button type="submit" class="btn btn-primary">Применить</button>
                                <a href="{% url 'moderation:adverts' %}" class="btn btn-outline-secondary">Сбросить</a>
                            </div>
                        </form>

                    </div>

                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="card-transparent bg-white rounded mb-4">
                <div class="card-header swiper-container d-slider2">
                    <div class="row">
                        {% for advert in adverts %}
                        <div class="col-lg-4" data-href="{% url 'moderation:advert_detail' advert.id %}" style="margin-bottom: 7%;">
                            <div class="iq-upcoming-cars">
                                {% if advert.images|length > 1 %}
                                <div style="position: relative; width: 100%; padding-top: 56.25%; /* пропорции 16:9 */">
                                  <img src="{{ advert.images.0 }}" class="img-fluid w-100" alt="{{ advert.name }}"
                                       style="position: absolute; top: 0; left: 0; height: 100%; object-fit: cover;"
                                       onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                                  <div style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #f0f0f0;"></div>
                                </div>
                                {% else %}
                                <div style="position: relative; width: 100%; padding-top: 56.25%; /* пропорции 16:9 */">
                                  <img src="{{ advert.images.0 }}" class="img-fluid w-100" alt="{{ advert.name }}"
                                       style="position: absolute; top: 0; left: 0; height: 100%; object-fit: cover;"
                                       onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                                  <div style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #f0f0f0;"></div>
                                </div>                                {% endif %}
                                <div class="iq-car-details">
                                    <h6 class="text-primary">{{ advert.name }}</h6>
                                    <div class="d-flex justify-content-end"></div>
                                </div>
                                <div class="iq-car-price d-flex justify-content-between align-items-center">
                                    <span>Цена</span>
                                    <h6>{{ advert.price }} {{ advert.currency }}</h6>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                {% include 'site/useraccount/include/paginations.html' with items=adverts %}


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}
{% block footertop %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("[data-href]").forEach(function (el) {
        el.style.cursor = "pointer";
        el.addEventListener("click", function () {
            window.location.href = el.getAttribute("data-href");
        });
    });
});
</script>

{% endblock footertop %}